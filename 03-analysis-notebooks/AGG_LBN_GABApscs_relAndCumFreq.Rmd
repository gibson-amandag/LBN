---
title: "R Notebook"
output: html_notebook
---


# Functions 

```{r}
getHighestBinVal <- function(df, varToSum, bin){
  maxDF <- df %>%
    summarize(
      max = max({{ varToSum }}, na.rm = TRUE)
    )
  
  maxVal <- maxDF$max[1]
  maxVal <- ceiling(maxVal / bin) * bin
  return(maxVal)
}

calcBinnedData <- function(
    df
    , varToSum
    , bin
    , groupBy = cellID
){
  
  maxVal <- getHighestBinVal(df, {{ varToSum }}, bin)
  
  binData <- df %>%
    mutate(
        bin = cut({{ varToSum }}, breaks = seq(0, maxVal, by = bin), right = FALSE, labels = seq(0, maxVal - bin, by = bin))
      , .after = {{ varToSum }}
    ) %>%
    group_by({{ groupBy }}, bin) %>%
    summarize(
      count = n()
      , .groups = "drop"
    )

allBins <- seq(0, maxVal - bin, by = bin)

# need to be sure to include empty bins for all cells
binData <- binData %>%
  complete(
    {{ groupBy }}
    , bin = factor(allBins)
    , fill = list(count = 0)
  ) %>%
  mutate(
    bin = as.numeric(as.character(bin))
  ) %>%
  arrange(
    {{ groupBy }}
    , bin
  )
  return(binData)
}


calcTotalEvents <- function(binData, groupBy){
  totalCounts <- binData %>%
    group_by({{ groupBy }}) %>%
    summarize(
      total = sum(count)
      , .groups = "drop"
    )
  return(totalCounts)
}

calcRelFreqByCell <- function(
    df
    , varToSum
    , bin
    , groupBy = cellID
    , contextDF = GABApscs_240Filtered %>%
      select(
        cellID
        , earlyLifeTrt
        , adultTrt
        , comboTrt
      )
){
  binData <- calcBinnedData(df, {{ varToSum }}, bin, groupBy = {{ groupBy }})
  totalCounts <- calcTotalEvents(binData, groupBy = {{ groupBy }})
  
  groupBy_str <- deparse(substitute(groupBy))
  
  relativePropData <- binData %>%
    left_join(
      totalCounts
      , by =  groupBy_str
    ) %>%
    mutate(
      relProp = count/total * 100
    ) %>%
    select(
      cellID
      , bin
      , relProp
    ) %>%
    left_join(
      contextDF
      , by = groupBy_str
    )
  
  return(relativePropData)
}

calcAvgRelFreqAndCumFreq <- function(
    df
    , varToSum
    , bin
    , contextDF = GABApscs_240Filtered %>%
      select(
        cellID
        , earlyLifeTrt
        , adultTrt
      )
){
  relativePropData <- calcRelFreqByCell(df, {{ varToSum }}, bin, groupBy = cellID, contextDF = contextDF)
  
  avgRelPropData <- relativePropData %>%
    group_by(earlyLifeTrt, adultTrt, bin) %>%
    summarize(
      avgRelProp = mean(relProp, na.rm = TRUE)
      , .groups = "drop"
    ) %>%
    combineStress()
  
  cumulativePropData <- avgRelPropData %>%
    arrange(
      earlyLifeTrt
      , adultTrt
      , bin
    ) %>%
    group_by(
      earlyLifeTrt
      , adultTrt
    ) %>%
    mutate(
      cumProp = cumsum(avgRelProp)
    ) %>%
    combineStress()
  
  return(cumulativePropData)
}
```

## Plotting

```{r}
plotRelDist <- function(
    df
    , xLab
    , yLab = "relative frequency (%)"
    , zoom_x = FALSE
    , xmin = NA
    , xmax = NA
    , zoom_y = FALSE
    , ymin = 0
    , ymax = 100
    , textSize = 16
    , legendPosition = c(0.6, 0.3)
){
  plot <- df %>%
    ggplot(
      aes(
        x = bin
        , y = avgRelProp
        , group = comboTrt
      )
    ) +
    geom_line(
      aes(
        color = comboTrt
      )
    ) +
    boxTheme() +
    textTheme(size = textSize) +
    expand_limits(y=0)+
    coord_cartesian(if(zoom_x){xlim = c(xmin, xmax)}, if(zoom_y){ylim = c(ymin, ymax)})+
    xlab(xLab) +
    ylab(yLab) +
    comboTrtLineColor(STD_CON_color = "grey50", LBN_CON_color = "#6dcae8") +
    theme(
      legend.position = legendPosition 
      , legend.key = element_blank()
    )
  return(plot)
}

plotCumFreqDist <- function(
    df
    , xLab
    , yLab = "cumulative frequency (%)"
    , zoom_x = FALSE
    , xmin = NA
    , xmax = NA
    , zoom_y = TRUE
    , ymin = 0
    , ymax = 100
    , textSize = 16
    , legendPosition = c(0.6, 0.3) 
){
  plot <- df %>%
    ggplot(
      aes(
        x = bin
        , y = cumProp
        , group = comboTrt
      )
    ) +
    geom_line(
      aes(
        color = comboTrt
      )
    ) +
    boxTheme() +
    textTheme(size = textSize) +
    expand_limits(y=0)+
    coord_cartesian(if(zoom_x){xlim = c(xmin, xmax)}, if(zoom_y){ylim = c(ymin, ymax)})+
    xlab(xLab) +
    ylab(yLab) +
    comboTrtLineColor(STD_CON_color = "grey50", LBN_CON_color = "#6dcae8") +
    theme(
      legend.position = legendPosition 
      , legend.key = element_blank()
    )
  return(plot)
}

plotCumFreqDist_allEvents <- function(
    df
    , xVar
    , xLab
    , yLab = "cumulative frequency (%)"
    , zoom_x = FALSE
    , xmin = NA
    , xmax = NA
    , zoom_y = TRUE
    , ymin = 0
    , ymax = 1
    , textSize = 16
    , legendPosition = c(0.6, 0.3) 
){
  plot <- df %>%
    ggplot(
      aes(
        x = {{ xVar }}
        , group = comboTrt
        , color = comboTrt
      )
    ) +
    stat_ecdf(geom = "line") +
    boxTheme() +
    textTheme(size = textSize) +
    expand_limits(y=0)+
    coord_cartesian(if(zoom_x){xlim = c(xmin, xmax)}, if(zoom_y){ylim = c(ymin, ymax)})+
    xlab(xLab) +
    ylab(yLab) +
    comboTrtLineColor(STD_CON_color = "grey50", LBN_CON_color = "#6dcae8") +
    theme(
      legend.position = legendPosition 
      , legend.key = element_blank()
    )
  return(plot)
}
```


```{r}
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')
```

# Set-up
```{r}
figureNum <- 1

pptBaseName <- makeBaseNameFunc("")

plotFolder <- file.path(plotOutputFolder, "distributionPlots")

imgType <-"png"

exportImg <- exportImg_forPurposeFunc(
  imgType = imgType
  , figNumFunc = pptBaseName
  , plotFolder = plotFolder
  , compType = currentCompType
)

exportFullPPTSlide <- function(
    plot = last_plot()
    , baseName = fileBaseName
    , figNum = figureNum
    , width = 11.5
    , height = 5
){
  exportImg(
    plot = plot
    , fileBaseName = baseName
    , figNum = figNum
    , units = "in"
    , width = width
    , height = height
  )
}

exportHalfPPTSlide <- function(
    plot = last_plot()
    , baseName = fileBaseName
    , figNum = figureNum
){
  exportImg(
    plot = plot
    , fileBaseName = baseName
    , figNum = figNum
    , units = "in"
    , width = 5.67
    , height = 5
  )
}

exportThirdPPTSlide <- function(
    plot = last_plot()
    , baseName = fileBaseName
    , figNum = figureNum
){
  exportImg(
    plot = plot
    , fileBaseName = baseName
    , figNum = figNum
    , units = "in"
    , width = 3.6
    , height = 5
  )
}

exportQuarterPPTSlide <- function(
    plot = last_plot()
    , baseName = fileBaseName
    , figNum = figureNum
){
  exportImg(
    plot = plot
    , fileBaseName = baseName
    , figNum = figNum
    , units = "in"
    , width = 3.2
    , height = 5
  )
}

editableImgs <- TRUE
pptAddOneGraph <- function(
    title = slideTitle
    , plot = last_plot()
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_oneGraph(
    officer_ppt, 
    title, 
    plot, 
    makeEditable = editableImgs
  )
  return(officer_ppt)
}

pptAddOneTable <- function(
    table
    , title = slideTitle
    , officer_ppt = ppt
    , dontFormat = TRUE
){
  officer_ppt <- addSlide_oneTable(
    officer_ppt, 
    title, 
    table, 
    dontFormat = dontFormat
  )
  return(officer_ppt)
}

pptUneditAddOneGraph <- function(
    title = slideTitle
    , plot = last_plot()
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_oneGraph(
    officer_ppt, 
    title, 
    plot, 
    makeEditable = FALSE
  )
  return(officer_ppt)
}

pptAddTwoGraphs <- function(
    plot1
    , plot2
    , title = slideTitle
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_twoGraph(
    officer_ppt, 
    title, 
    plot1, 
    plot2,
    makeEditable = editableImgs
  )
  return(officer_ppt)
}

pptAddTwoGraphsMoreLeft <- function(
    plot1
    , plot2
    , title = slideTitle
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_twoGraphMoreLeft(
    officer_ppt, 
    title, 
    plot1, 
    plot2,
    makeEditable = editableImgs
  )
  return(officer_ppt)
}

pptAddGraphTable <- function(
    plot
    , table
    , title = slideTitle
    , officer_ppt = ppt
    , dontFormat = TRUE
){
  officer_ppt <- addSlide_graphTable(
    officer_ppt, 
    title, 
    plot, 
    table,
    makeEditable = editableImgs
    , dontFormat = dontFormat
    , textSize = textSize
  )
  return(officer_ppt)
}

pptAddFourGraphs <- function(
    plot1
    , plot2
    , plot3
    , plot4
    , title = slideTitle
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_fourGraph(
    officer_ppt, 
    title, 
    plot1, 
    plot2, 
    plot3,
    plot4,
    makeEditable = editableImgs
    )
  return(officer_ppt)
}

pptAddThreeGraphs <- function(
    plot1
    , plot2
    , plot3
    , title = slideTitle
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_threeGraph(
    officer_ppt, 
    title, 
    plot1, 
    plot2, 
    plot3,
    makeEditable = editableImgs
    )
  return(officer_ppt)
}

pptAddStats <- function(
    statsText
    , officer_ppt = ppt
){
  officer_ppt <- addStatsToBottom(
    officer_ppt,
    statsText
  )
}

pptAddTwoStats <- function(
    statsText1
    , statsText2
    , officer_ppt = ppt
){
  officer_ppt <- addTwoStatsToGraphs(
    officer_ppt,
    statsText1,
    statsText2
  )
}

pptAddSectionHead <- function(
    title = slideTitle
    , officer_ppt = ppt
){
  officer_ppt <- addSlide_sectionHead(
    officer_ppt
    , title
  )
}



```

## Fresh doc

```{r}
# make powerpoint and title slide
ppt <- read_pptx("genericPPT.pptx")
ppt <- add_slide(ppt, layout = "Title Slide")

# layout_properties(ppt, layout="Title Slide")

subText <- "Amanda Gibson\nPSC distribution plots, averaged by cell"
ppt <- ph_with(
  ppt,
  value = subText,
  location = ph_location_label("Subtitle 2")
)


# Run this function to save the PPT file to the disk
# On windows, don't run if the PPT file is open
savePPT <- makeSavePPTFunc(
  presPPT = ppt
  , presFolder = plotFolder
  , presFileName = "AGG_PSC_distributions"
  , addDate = TRUE
)
```

# Results

## Attempt 1

### Amp

```{r}
amplitude_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, amplitude, 5)

amplitude_relDist_plot <- plotRelDist(amplitude_avgDistByCell, "amplitude (pA)")
amplitude_cumFreq_plot <- plotCumFreqDist(amplitude_avgDistByCell, "amplitude (pA)")

amplitude_relDist_plot
amplitude_cumFreq_plot
```
### Rise time

```{r}
riseTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, riseTime, 0.05)

riseTime_relDist_plot <- plotRelDist(riseTime_avgDistByCell, "rise time (ms)")
riseTime_cumFreq_plot <- plotCumFreqDist(riseTime_avgDistByCell, "rise time (ms)")

riseTime_relDist_plot
riseTime_cumFreq_plot
```
### Decay time

```{r}
decayTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, decay9010, 1.5)

decayTime_relDist_plot <- plotRelDist(decayTime_avgDistByCell, "decay time (ms)")
decayTime_cumFreq_plot <- plotCumFreqDist(decayTime_avgDistByCell, "decay time (ms)")

decayTime_relDist_plot
decayTime_cumFreq_plot
```
### Full width half max

```{r}
fwhm_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, fwhm, 0.5)

fwhm_relDist_plot <- plotRelDist(fwhm_avgDistByCell, "fwhm (ms)")
fwhm_cumFreq_plot <- plotCumFreqDist(fwhm_avgDistByCell, "fwhm (ms)")

fwhm_relDist_plot
fwhm_cumFreq_plot
```

## Bigger bins

```{r}
amplitude_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, amplitude, 10)

amplitude_relDist_plot <- plotRelDist(amplitude_avgDistByCell, "amplitude (pA)")
amplitude_cumFreq_plot <- plotCumFreqDist(amplitude_avgDistByCell, "amplitude (pA)")

amplitude_relDist_plot
amplitude_cumFreq_plot
```

```{r}
riseTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, riseTime, 0.1)

riseTime_relDist_plot <- plotRelDist(riseTime_avgDistByCell, "rise time (ms)")
riseTime_cumFreq_plot <- plotCumFreqDist(riseTime_avgDistByCell, "rise time (ms)")

riseTime_relDist_plot
riseTime_cumFreq_plot
```

```{r}
decayTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, decay9010, 3)

decayTime_relDist_plot <- plotRelDist(decayTime_avgDistByCell, "decay time (ms)")
decayTime_cumFreq_plot <- plotCumFreqDist(decayTime_avgDistByCell, "decay time (ms)")

decayTime_relDist_plot
decayTime_cumFreq_plot
```

```{r}
fwhm_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, fwhm, 1)

fwhm_relDist_plot <- plotRelDist(fwhm_avgDistByCell, "fwhm (ms)")
fwhm_cumFreq_plot <- plotCumFreqDist(fwhm_avgDistByCell, "fwhm (ms)")

fwhm_relDist_plot
fwhm_cumFreq_plot
```

## Restricted X

### Amp

```{r}
amplitude_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, amplitude, 5)

amplitude_relDist_plot <- plotRelDist(amplitude_avgDistByCell, "amplitude (pA)", zoom_x = TRUE, xmax = 125, legendPosition = c(0.6, 0.5))
amplitude_cumFreq_plot <- plotCumFreqDist(amplitude_avgDistByCell, "amplitude (pA)", zoom_x = TRUE, xmax = 125)

amplitude_relDist_plot
fileBaseName <- "amplitude_relDist_bin5"
slideTitle <- "Amplitude - 5pA bin - relative distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()

amplitude_cumFreq_plot

fileBaseName <- "amplitude_cumFreqDist_bin5"
slideTitle <- "Amplitude - 5pA bin - cumulative frequency distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()
```

### Rise time

```{r}
riseTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, riseTime, 0.05)

riseTime_relDist_plot <- plotRelDist(riseTime_avgDistByCell, "rise time (ms)", zoom_x = TRUE, xmax = 2.3, legendPosition = c(0.6, 0.6))
riseTime_cumFreq_plot <- plotCumFreqDist(riseTime_avgDistByCell, "rise time (ms)", zoom_x = TRUE, xmax = 2.3)

riseTime_relDist_plot
fileBaseName <- "riseTime_relDist_bin5"
slideTitle <- "Rise time - 0.05ms bin - relative distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()

riseTime_cumFreq_plot

fileBaseName <- "riseTime_cumFreqDist_bin5"
slideTitle <- "Rise time - 0.05ms bin - cumulative frequency distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()
```

### Decay time

```{r}
decayTime_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, decay9010, 1.5)

decayTime_relDist_plot <- plotRelDist(decayTime_avgDistByCell, "decay time (ms)", zoom_x = TRUE, xmax = 100, legendPosition = c(0.6, 0.7))
decayTime_cumFreq_plot <- plotCumFreqDist(decayTime_avgDistByCell, "decay time (ms)", zoom_x = TRUE, xmax = 100)

decayTime_relDist_plot
fileBaseName <- "decayTime_relDist_bin5"
slideTitle <- "Decay time - 1.5ms bin - relative distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()

decayTime_cumFreq_plot

fileBaseName <- "decayTime_cumFreqDist_bin5"
slideTitle <- "Decay time - 1.5ms bin - cumulative frequency distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()
```
### FWHM

```{r}
fwhm_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, fwhm, 0.5)

fwhm_relDist_plot <- plotRelDist(fwhm_avgDistByCell, "fwhm (ms)", zoom_x = TRUE, xmax = 22, legendPosition = c(0.7, 0.6))
fwhm_cumFreq_plot <- plotCumFreqDist(fwhm_avgDistByCell, "fwhm (ms)", zoom_x = TRUE, xmax = 22)

fwhm_relDist_plot
fileBaseName <- "fwhm_relDist_bin5"
slideTitle <- "FWHM - 0.5ms bin - relative distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()

fwhm_cumFreq_plot

fileBaseName <- "fwhm_cumFreqDist_bin5"
slideTitle <- "FWHM - 0.5ms bin - cumulative frequency distribution"
exportFullPPTSlide()
ppt <- pptAddOneGraph()
```

## Restricted X + median model

### Amp

```{r}
amplitude_avgDistByCell <- calcAvgRelFreqAndCumFreq(pscProps, amplitude, 5)

amplitude_relDist_plot <- plotRelDist(amplitude_avgDistByCell, "amplitude (pA)", zoom_x = TRUE, xmax = 125, legendPosition = c(0.6, 0.5))
amplitude_cumFreq_plot <- plotCumFreqDist(amplitude_avgDistByCell, "amplitude (pA)", zoom_x = TRUE, xmax = 125)

amplitude_cumFreq_plot +
  plotError_LMM_aes_xAxis(
    amplitudeMedian_errors
    , meanBarWidth = 10
  )

amplitude_cumFreq_plot +
  plotError_LMM_aes_xAxis(
    amplitude_median_errors # cell medians
    , meanBarWidth = 10
  )

pscProps %>%
  combineStress() %>%
  plotCumFreqDist_allEvents(
    xVar = amplitude
    , xLab = "amplitude (pA)"
    , zoom_x = TRUE
    , xmax = 125
  ) +
  # plotError_LMM_aes_xAxis(
  #   amplitudeMedian_errors
  #   , meanBarWidth = .1
  #   , nudgeLine = 0
  #   , yVal = 0.5
  # )
  geom_errorbar(
      aes(
        y = 0.5
        , xmin = y
        , xmax = y
        , color = comboTrt
      )
      , data = amplitudeMedian_errors
      , inherit.aes = FALSE
      , width = .1
      , linewidth = .6
  ) + 
  geom_linerange(
    aes(
      y = 0.5
      , xmin = lower
      , xmax = upper
      , color = comboTrt
    )
    , data = amplitudeMedian_errors
    , inherit.aes = FALSE
    , linewidth = .6
  )
```
# Anderson-Darling test


```{r}
library(kSamples)
```
## Amplitude 

```{r}
group_STD_CON <- amplitude_avgDistByCell$cumProp[amplitude_avgDistByCell$earlyLifeTrt == "STD" & amplitude_avgDistByCell$adultTrt == "CON"]
group_STD_ALPS <- amplitude_avgDistByCell$cumProp[amplitude_avgDistByCell$earlyLifeTrt == "STD" & amplitude_avgDistByCell$adultTrt == "ALPS"]
group_LBN_CON <- amplitude_avgDistByCell$cumProp[amplitude_avgDistByCell$earlyLifeTrt == "LBN" & amplitude_avgDistByCell$adultTrt == "CON"]
group_LBN_ALPS <- amplitude_avgDistByCell$cumProp[amplitude_avgDistByCell$earlyLifeTrt == "LBN" & amplitude_avgDistByCell$adultTrt == "ALPS"]

# Perform the Anderson-Darling test to compare the four distributions
ad_test_result <- ad.test(group_STD_CON, group_STD_ALPS, group_LBN_CON, group_LBN_ALPS)

# Output the results
print(ad_test_result)
```
```{r}
groups_list <- list(
  "STD-CON" = group_STD_CON
  , "LBN-CON" = group_LBN_CON
  , "STD-ALPS" = group_STD_ALPS
  , "LBN-ALPS" = group_LBN_ALPS
)
# Pairwise Anderson-Darling tests
pairs <- combn(length(groups_list), 2, simplify = FALSE)
pairwise_results <- lapply(pairs, function(p) {
  list(groups = p, 
       test_result = ad.test(groups_list[[p[1]]], groups_list[[p[2]]]))
})

# Print the pairwise test results
for (result in pairwise_results) {
  cat("Comparing Group", result$groups[1], "and Group", result$groups[2], ":\n")
  print(result$test_result)
  cat("\n")
}
```


```{r}
getAD_Pval <- function(result, version = 1, fromPaired = FALSE){
  if(fromPaired){
    result <- result$test_result
  }
  tbl <- result$ad
  tbl_tibble <- tbl %>% as.tibble()
  p_val <- tbl_tibble$` asympt. P-value`[[version]]
  return(p_val)
}
```

Group 1 = STD-CON, Group 2 = LBN-CON, Group 3 = STD-ALPS, Group 4 = LBN-ALPS
```{r}
# Assuming 'pairwise_results' contains the results of your pairwise Anderson-Darling tests
# Extracting p-values from the test results
p_values <- sapply(pairwise_results, function(result){
  p_val <- getAD_Pval(result, fromPaired = TRUE)
  return(p_val)
})

# Apply the Holm correction to the p-values
p_adjusted <- p.adjust(p_values, method = "holm")

# Pairwise comparison labels
pair_labels <- sapply(pairs, function(p) paste("Group", p[1], "vs Group", p[2]))

# Combine the labels and adjusted p-values into a data frame for a clearer presentation
comparison_results <- data.frame(
  Pair = pair_labels,
  P_Value = p_values,
  P_Adjusted = p_adjusted
)

# Print the results with Holm correction
print(comparison_results)
```

## Rise Time 

```{r}
group_STD_CON <- riseTime_avgDistByCell$cumProp[riseTime_avgDistByCell$earlyLifeTrt == "STD" & riseTime_avgDistByCell$adultTrt == "CON"]
group_STD_ALPS <- riseTime_avgDistByCell$cumProp[riseTime_avgDistByCell$earlyLifeTrt == "STD" & riseTime_avgDistByCell$adultTrt == "ALPS"]
group_LBN_CON <- riseTime_avgDistByCell$cumProp[riseTime_avgDistByCell$earlyLifeTrt == "LBN" & riseTime_avgDistByCell$adultTrt == "CON"]
group_LBN_ALPS <- riseTime_avgDistByCell$cumProp[riseTime_avgDistByCell$earlyLifeTrt == "LBN" & riseTime_avgDistByCell$adultTrt == "ALPS"]

# Perform the Anderson-Darling test to compare the four distributions
ad_test_result <- ad.test(group_STD_CON, group_STD_ALPS, group_LBN_CON, group_LBN_ALPS)

# Output the results
print(ad_test_result)
```
```{r}
groups_list <- list(
  "STD-CON" = group_STD_CON
  , "LBN-CON" = group_LBN_CON
  , "STD-ALPS" = group_STD_ALPS
  , "LBN-ALPS" = group_LBN_ALPS
)
# Pairwise Anderson-Darling tests
pairs <- combn(length(groups_list), 2, simplify = FALSE)
pairwise_results <- lapply(pairs, function(p) {
  list(groups = p, 
       test_result = ad.test(groups_list[[p[1]]], groups_list[[p[2]]]))
})

# Print the pairwise test results
for (result in pairwise_results) {
  cat("Comparing Group", result$groups[1], "and Group", result$groups[2], ":\n")
  print(result$test_result)
  cat("\n")
}
```

Group 1 = STD-CON, Group 2 = LBN-CON, Group 3 = STD-ALPS, Group 4 = LBN-ALPS

I'm not following this based on what the plot looks like. It should be LBN-CON that's different
```{r}
# Assuming 'pairwise_results' contains the results of your pairwise Anderson-Darling tests
# Extracting p-values from the test results
p_values <- sapply(pairwise_results, function(result){
  p_val <- getAD_Pval(result, fromPaired = TRUE)
  return(p_val)
})

# Apply the Holm correction to the p-values
p_adjusted <- p.adjust(p_values, method = "holm")

# Pairwise comparison labels
pair_labels <- sapply(pairs, function(p) paste("Group", p[1], "vs Group", p[2]))

# Combine the labels and adjusted p-values into a data frame for a clearer presentation
comparison_results <- data.frame(
  Pair = pair_labels,
  P_Value = p_values,
  P_Adjusted = p_adjusted
)

# Print the results with Holm correction
print(comparison_results)
```


