---
title: "R Notebook"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
# options(digits=3)
```

```{r include=FALSE}
source("./01-scripts/01-set-up.R")
source(file.path(scriptsFolder, "02-get-datasets.R"))
```


```{r}
samplingDF_today <- AcuteStress_off %>%
  filter(
    Sac_date == dateToday
    # Cohort == 5
  )
samplingDF_today <- samplingDF_today %>%
  addRegExForSamplingDF() %>%
  addSamplingImgFilePaths()
samplingDF_today

samplingPPT <- read_pptx("./samplingSlideTemplate.pptx")
samplingPPT <- add_slide(samplingPPT, layout = "Title Slide")
samplingPPT <- ph_with(
  samplingPPT,
  value = paste(dateToday),
  location = ph_location_label("Title 1")
)
addSamplingSlidesFromDF(
  samplingDF_today, 
  samplingPPT = samplingPPT, 
  cyclingDF = Cycles_off_all %>%
    filter(
      Mouse_ID %in% samplingDF_today$Mouse_ID
    )
)
# file.access(
file.info(
  file.path(reportOutputFolder, "samplingPPTs", paste0("sampling_", 
                                                       # "2021-09-02",
                                                       dateToday,
                                                       ".pptx"))
  # ,
  # mode = 4
)
file.info(
  file.path(reportOutputFolder, "samplingPPTs", paste0("sampling_", 
                                                       "2021-09-02",
                                                       # dateToday,
                                                       ".pptx"))
  # ,
  # mode = 4
)
reportOutputFolder
# print(samplingPPT, target = "./testCyclingOutput.pptx")
print(samplingPPT, target = file.path(reportOutputFolder, "samplingPPTs", paste0("sampling_", dateToday, ".pptx")))
```

Cohorts 4 + 6
```{r eval=FALSE, include=FALSE}
samplingDF_ALPS <- AcuteStress_off %>%
  filter(
    sex == "F",
    !is.na(cyclingFolderPath),
    Dam_Strain == "CBA",
    Cohort == 4 | Cohort == 6
  )

samplingDF_ALPS <- samplingDF_ALPS %>%
  addRegExForSamplingDF() %>%
  addSamplingImgFilePaths()

samplingPPT <- read_pptx("./samplingSlideTemplate.pptx")
samplingPPT <- add_slide(samplingPPT, layout = "Title Slide")
samplingPPT <- ph_with(
  samplingPPT,
  value = "LBN Cycling Images, Uterine Mass, and LH Values",
  location = ph_location_label("Title 1")
)
addSamplingSlidesFromDF(
  samplingDF_ALPS, 
  samplingPPT = samplingPPT, 
  cyclingDF = Cycles_off_all %>%
    filter(
      Mouse_ID %in% samplingDF_ALPS$Mouse_ID
    )
)
print(samplingPPT, target = file.path(reportOutputFolder, "samplingPPTs", paste0(
  "LBN_ALPS_samplingImgs", 
  # dateToday, 
  ".pptx")
  )
)
```
Full Presentation by Cycle Stage - All CBAs
```{r eval=FALSE, include=FALSE}
samplingDF_ALPS <- AcuteStress_off %>%
  filter(
    sex == "F",
    !is.na(cyclingFolderPath),
    Dam_Strain == "CBA"
    # Cohort == 4 | Cohort == 5 | Cohort == 6
  ) 
samplingDF_ALPS

samplingDF_ALPS <- samplingDF_ALPS %>%
  addRegExForSamplingDF(arrangeByCycle = TRUE) %>%
  addSamplingImgFilePaths()

samplingPPT <- read_pptx("./samplingSlideTemplate.pptx")
samplingPPT <- add_slide(samplingPPT, layout = "Title Slide")
samplingPPT <- ph_with(
  samplingPPT,
  value = "LBN Cycling Images, Uterine Mass, and LH Values",
  location = ph_location_label("Title 1")
)
addSamplingSlidesFromDF(
  samplingDF_ALPS, 
  samplingPPT = samplingPPT, 
  cyclingDF = Cycles_off_all %>%
    filter(
      Mouse_ID %in% samplingDF_ALPS$Mouse_ID
    )
)
print(samplingPPT, target = file.path(reportOutputFolder, "samplingPPTs", paste0(
  "LBN_ALPS_samplingImgs_byStage", 
  # dateToday, 
  ".pptx")
  )
)
```

# Remaining Today
```{r eval=FALSE, include=FALSE}
remainingDF_today <- LBN_data %>%
  filter(
    sex == "F",
    Litter_num == 2,
    is.na(Sac_date),
    is.na(Sac_stop_off)
  ) %>%
  mutate(
    Sac_date = dateToday
  ) %>%
  calcAgeInDays() %>%
  combineStress()

remainingDF_today <- remainingDF_today %>%
  addRegExForSamplingDF() %>%
  addSamplingImgFilePaths()

samplingPPT <- read_pptx("./samplingSlideTemplate.pptx")
samplingPPT <- add_slide(samplingPPT, layout = "Title Slide")
samplingPPT <- ph_with(
  samplingPPT,
  value = paste("Mice remaining on", dateToday),
  location = ph_location_label("Title 1")
)
addSamplingSlidesFromDF(
  remainingDF_today, 
  samplingPPT = samplingPPT, 
  cyclingDF = Cycles_off_all %>%
    filter(
      Mouse_ID %in% remainingDF_today$Mouse_ID
    )
)

remainingDF_today

print(samplingPPT, target = file.path(reportOutputFolder, "remainingPPTs", paste0("remaining_", dateToday, ".pptx")))
```

Cohort 1 CBAs
```{r eval=FALSE, include=FALSE}
cohort1ALPSDF <- AcuteStress_off %>%
  filter(
    sex == "F",
    Cohort == 1,
    Dam_Strain == "CBA"
  )

cohort1ALPSDF <- cohort1ALPSDF %>%
  addRegExForSamplingDF() %>%
  addSamplingImgFilePaths()

samplingPPT <- read_pptx("./samplingSlideTemplate.pptx")
samplingPPT <- add_slide(samplingPPT, layout = "Title Slide")
samplingPPT <- ph_with(
  samplingPPT,
  value = "LBN_0001 Offspring of CBA dams",
  location = ph_location_label("Title 1")
)
addSamplingSlidesFromDF(
  cohort1ALPSDF, 
  samplingPPT = samplingPPT, 
  cyclingDF = Cycles_off_all %>%
    filter(
      Mouse_ID %in% cohort1ALPSDF$Mouse_ID
    )
)

cohort1ALPSDF

print(samplingPPT, target = file.path(reportOutputFolder, "samplingPPTs", paste0("LBN_0001-sampling", ".pptx")))
```
