---
title: "R Notebook"
output:
  word_document: default
  html_notebook: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
# options(digits=3)
```

```{r include=FALSE}
source("./01-scripts/01-set-up.R")
source(file.path(scriptsFolder, "02-get-datasets.R"))
source(file.path(scriptsFolder, "CRHcreL10-get-datasets.R"))
```

```{r}
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')
```

```{r}
JL_allInfo %>%
  filter(
    is.na(sacDateOff),
    is.na(Sac_date),
    DOB >= as.Date("2022-01-01"),
    cycleID >= 44 & cycleID <=87
  ) %>%
   unite(
    comboTrt,
    adultTrt,
    perfusionHr,
    sep = "-",
    remove = FALSE
  ) %>%
  mutate(
    comboTrt = factor(comboTrt, levels = c("CON-2.5", "ALPS-2.5", "CON-5", "ALPS-5"))
  ) %>%
  createRemainingPPT(
    cyclesDF = JL_cycles,
    addToName = "JL"
  )
```


```{r}
df <- JL_allInfo %>%
  filter(
    DOB >= as.Date("2022-01-01"),
    cycleID >= 44 & cycleID <=87
  ) %>%
  select(
    mouseID,
    damID,
    adultTrt,
    perfusionHr,
    UterineDescription
  ) %>%
  mutate(
    hitPro = NA
  ) %>%
  arrange(
    mouseID
  )

saveDFsToExcel(
  "AG_JL_CRH-cre_L10a_mice_trt",
  "df" = df,
  prefix = NULL
)
```

```{r}
JL_LH
```


```{r}
JL_stressInfo <- JL_acuteStress %>%
  select(
    mouseID
    , Sampling_date
    , Sac_cycle
    , perfusionHr
    , Dosage
    , adultTrt
    , starts_with("cort")
    , starts_with("LH")
    , maxLH
  ) %>%
  filter(
    !is.na(perfusionHr)
  )

saveDFsToExcel(
  "stressInfo"
  , prefix = JL_filePrefix
  , "stressInfo" = JL_stressInfo
)
```

```{r}
JL_LH_plot <- JL_LH %>%
  filter(
    !is.na(perfusionHr)
    , !is.na(cycleID)
    # , time == 0
  ) %>%
  LHPlot_adultTrt(
    dotSize = 3
    , fontSize = 16
  ) +
  facet_wrap(
    vars(adultTrt)
    , nrow = 1
  )

JL_LH_plot

flexSave(
  "LH"
  , JL_filePrefix
  , fileType = "png"
  , width = JL_width
  , height = JL_height
)
```


```{r}
df <- JL_acuteStress %>%
  filter(
    !is.na(cycleID)
    , is.na(Dosage)
    , !is.na(perfusionHr)
    # , mouseID == "CRH53"
  ) %>%
  calcAgeInDays(
      ageAtDateVar = Sampling_date
  ) %>%
  mutate(
      comboNotes = paste0(
        "uterus: ", UterineDescription,
        "\nAM LH: ", LH_hr0, " ng/mL"
        , "\nAge: ", AgeInDays
      )
    ) %>%
  select(
    -AgeInDays
  ) %>%
  createSamplingPPT(
    cyclesDF = JL_cycles
    , useVar = Sampling_date
    , addToName = "CRH_L10a"
    , showNextDay = FALSE
    , includeNotes = TRUE
    , notesVar = comboNotes
    , slideVersion = 4
    , includeUterus = FALSE
  )
```

```{r}
JL_acuteStress %>%
  filter(
    LH_hr0 > 3
  ) %>%
  select(
    mouseID,
    LH_hr0
  )
```

```{r}
JL_acuteStress %>%
  filter(
    is.na(cort_hr0)
  )
```

