---
title: "R Notebook"
output: html_notebook
# fig-width: 11.5
# fig-height: 5
df-print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
# knitr::opts_chunk$set(fig.width=11.5, fig.height=5) 
# options(digits=3)
```

```{r include=FALSE}
source("./01-scripts/01-set-up.R")
source(file.path(scriptsFolder, "02-get-datasets.R"))
source("./01-scripts/04-filter-datasets.R")
source("./01-scripts/05-make-LBN-plots-manuscript.R")
source("./01-scripts/06-make-LBN-ANOVAs_noLitter.R")
```

```{r}
doc.type <- knitr::opts_knit$get('rmarkdown.pandoc.to')
```

# Column Sizes
```{r}
# JNeuro values (in cm)
twoCols <- 17.4
oneAndHalfCols <- 11.5
oneCol <- 8.5
```

# Figure 1 - Dams figDams

```{r}
# trying to fix font errors
# this seems to work for not putting the axis label on top of the tick labels
# but the axes don't actually align with align_plots
# update - Maybe works???? IDK WHAT I DID!
set_null_device("png") 

# # this works for aligning the axes with align_plots
# # but then faceted plot yaxis label overlaps
# set_null_device("pdf")
# 
# # this works for aligning the axes with align_plots
# # but then faceted plot yaxis label overlaps
# set_null_device("cairo_pdf")
```


```{r}
figDamsPlots <- cowplot::align_plots(figDamsB, figDamsC, align = "v", axis = "l")

figDams <- plot_grid(
  NULL
  , figDamsPlots[[1]]
  , NULL
  , plot_grid(
    figDamsPlots[[2]]
    , figDamsD
    , ncol = 2
    , labels = c("C", "D")
    , label_fontfamily = "Arial"
    , label_size = textSize
  )
  , nrow = 4
  , labels = c("A", NULL, "B", NULL)
  , label_fontfamily = "Arial"
  , label_size = textSize
  , rel_heights = c(0.5, 1, .1, 1)
)
figDams
```


```{r}
flexSave(
  "figDams"
  , plot = figDams
  , width = twoCols
  , heigh = 28/3*2
  , units = "cm"
)
```

# Figure 2 - Offspring maturation figOff

```{r}
figOffLeftPlots <- cowplot::align_plots(
  figOffA
  , figOffB
  , figOffC
  , align = "v", axis = "l"
)

figOffMidPlots <- cowplot::align_plots(
  figOffD
  , figOffE
  , align = "v", axis = "l"
)

figOffRightPlots <- cowplot::align_plots(
  figOffF
  , figOffG
  , align = "v", axis = "l"
)

figOffRow2 <- plot_grid(
  figOffLeftPlots[[2]]
  , figOffMidPlots[[1]]
  , figOffRightPlots[[1]]
  , ncol = 3
  , labels = c("Bi", "Ci", "Di")
  , label_fontfamily = "Arial"
  , label_size = textSize
)

figOffRow3 <- plot_grid(
  figOffLeftPlots[[3]]
  , figOffMidPlots[[2]]
  , figOffRightPlots[[2]]
  , ncol = 3
  , labels = c("Bii", "Cii", "Dii")
  , label_fontfamily = "Arial"
  , label_size = textSize
)

figOff <- plot_grid(
  figOffLeftPlots[[1]]
  , figOffRow2
  , figOffRow3
  , nrow = 3
  , labels = c("A", NULL, NULL)
  , label_fontfamily = "Arial"
  , label_size = textSize
  , rel_heights = c(1.5, 1, 1)
)
figOff
```

```{r}
flexSave(
  "figOff"
  , plot = figOff
  , width = twoCols
  , heigh = 28/3*2
  , units = "cm"
)
```

# Figure 3 - Cycles

```{r}
figCyclesLeftPlots <- cowplot::align_plots(
  figCyclesA
  , figCyclesB
  , align = "v", axis = "l"
)

figCycles2ndRow <- plot_grid(
  figCyclesLeftPlots[[2]]
  , figCyclesC
  , figCyclesD
  , ncol = 3
  , labels = c("B", "C", "D")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "h"
  , axis = "bt"
  , rel_widths = c(1, 1, 2)
)

figCycles <- plot_grid(
  figCyclesLeftPlots[[1]]
  , figCycles2ndRow
  , nrow = 2
  , rel_heights = c(2.2, 3)
  , labels = c("A", NULL)
  , label_fontfamily = "Arial"
  , label_size = textSize
)
figCycles
```

```{r}
flexSave(
  "figCycles"
  , plot = figCycles
  , width = twoCols
  , height = 28/3
  , units = "cm"
)
```

# Figure 4 - Corticosterone

```{r}
figCort_opt1 <- plot_grid(
  get_legend(figCort_opt1A)
  , figCort_opt1A + rremove("legend")
  , figCort_opt1B + rremove("legend")
  , figCort_opt1C + rremove("legend")
  , nrow = 4
  , labels = c("", "A", "B", "C")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "v"
  , axis = "lr"
  , rel_heights = c(0.2, 1, 1, 1)
)

figCort_opt1
```

```{r}
flexSave(
  "figCort_opt1"
  , plot = figCort_opt1
  , width = oneCol
  , height = 28/3*2
  , units = "cm"
)
```

```{r}
figCort_opt2 <- plot_grid(
  figCort_opt2A
  , figCort_opt2B
  , figCort_opt2C
  , nrow = 3
  , labels = c("A", "B", "C")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "v"
  , axis = "lr"
)
figCort_opt2
```

```{r}
flexSave(
  "figCort_opt2"
  , plot = figCort_opt2
  , width = twoCols
  , height = 28/3 *2
  , units = "cm"
)
```

```{r}
figCort_opt3_graphs <- plot_grid(
  figCort_opt3A + rremove("legend")
  , figCort_opt3B + rremove("legend")
  , figCort_opt3C + rremove("legend")
  , ncol = 3
  , labels = c("A", "B", "C")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "h"
  , axis = "tb"
)

figCort_opt3 <- plot_grid(
  figCort_opt3_graphs
  , get_legend(figCort_opt3A)
  , nrow = 2
  , rel_heights = c(1, .03)
)

figCort_opt3
```

```{r}
flexSave(
  "figCort_opt3"
  , plot = figCort_opt3
  , width = twoCols
  , height = 28/3
  , units = "cm"
)
```

# Figure 5 - LH


# Figure 6 - GABA PSCs

```{r}
figGABA1stCol <- cowplot::align_plots(
  figGABAa
  , figGABAe
  , align = "v", axis = "l"
)

figGABA2ndCol <- cowplot::align_plots(
  figGABAb
  , figGABAf
  , align = "v", axis = "l"
)

# eventually 3rd col

figGABA1stRow <- plot_grid(
  figGABA1stCol[[1]]
  , figGABA2ndCol[[1]]
  , figGABAc
  , figGABAd
  , ncol = 4
  , labels = c("A", "B", "C", "D")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "h"
  , axis = "bt"
)

figGABA2ndRow <- plot_grid(
  figGABA1stCol[[2]]
  , figGABA2ndCol[[2]]
  , NULL
  , ncol = 3
  , labels = c("E", "F", "G - avg trace?")
  , label_fontfamily = "Arial"
  , label_size = textSize
  , align = "h"
  , axis = "bt"
  , rel_widths = c(1, 1, 2)
)

figGABA <- plot_grid(
  figGABA1stRow
  , figGABA2ndRow
  , nrow = 2
  # , rel_heights = c(2, 3)
)

figGABA
```

```{r}
flexSave(
  "figGABA"
  , plot = figGABA
  , width = twoCols
  , height = 28/2
  , units = "cm"
)
```

```{r eval=FALSE, include=FALSE}
# testing alignment... don't know what I acutally learned or didn't from these...
figDamsPlots <- cowplot::align_plots(figDamsC, figDamsB + facet_wrap(~earlyLifeTrt, nrow =1), align = "v", axis = "l", greedy = FALSE)
plot_grid(
  # figDamsB
  # , figDamsC
  # , align = "v"
  # , axis = "l"
  figDamsPlots[[1]]
  , figDamsPlots[[2]]
  , nrow = 2
  , labels = c("B", "C")
)

figDamsPlots <- cowplot::align_plots(
  figDamsC
  , figDamsB + facet_wrap(~earlyLifeTrt, nrow =1)
  # , figDamsB
  , align = "v"
  , axis = "l"
  , greedy = TRUE
)
plot_grid(
  # figDamsB
  # , figDamsC
  # , align = "v"
  # , axis = "l"
  figDamsPlots[[1]]
  , figDamsPlots[[2]]
  , nrow = 2
  , labels = c("B", "C")
)

figDamsPlots <- cowplot::align_plots(
  figDamsC
  # , figDamsB + facet_wrap(~earlyLifeTrt, nrow =1)
  , figDamsB
  , align = "v"
  , axis = "l"
  , greedy = TRUE
)
plot_grid(
  # figDamsB
  # , figDamsC
  # , align = "v"
  # , axis = "l"
  figDamsPlots[[1]]
  , figDamsPlots[[2]]
  , nrow = 2
  , labels = c("B", "C")
)


```

```{r eval=FALSE, include=FALSE}
install.packages("patchwork")
library(patchwork)
```

```{r eval=FALSE, include=FALSE}
plot_spacer() / (figDamsB + facet_wrap(~earlyLifeTrt, nrow =1)) / (figDamsC | figDamsD) +
  plot_layout(
    heights = c(0.5, 1, 1)
  )

layout <- "
##
AA
BC
"

figDamsB + facet_wrap(~earlyLifeTrt, nrow = 1) + figDamsC + figDamsD +
  plot_layout(design = layout)
```



# Offspring

## Body mass of offspring seems to follow three roughly linear patterns: P11-P21, P22-P35, P42-P72

```{r}
mass_plot_1stL
```

## Body mass of mass LBN pups seems most impacted by the paradigm

```{r}
mass_plot_1stL +
  coord_cartesian(x = c(11, 21), y = c(0, 16))
```

## Body mass of mass LBN pups seems most impacted by the paradigm

```{r}
lmm <- mass_long %>%
  filter(
    day >= 11 & day <= 21
  ) %>%
  mutate(
    day = day - 11
  ) %>%
  runLMM(
    mass ~ earlyLifeTrt * day * sex + (1|damID) + (1|mouseID)
  )

lmm$anova %>% formatLMM_ppt()
```

## Body mass of mass LBN pups seems most impacted by the paradigm


```{r}

lmm$coefs %>% formatLMM_ppt()

coefs <- lmm$coefs

mass11Intercept <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "(Intercept)"
    , valCol = "Estimate"
  )

mass11LBN <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN"
    , valCol = "Estimate"
  )

mass11Sex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "sexM"
    , valCol = "Estimate"
  )

mass11PND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day"
    , valCol = "Estimate"
  )

mass11LBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day"
    , valCol = "Estimate"
  )

mass11LBNchangeSex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:sexM"
    , valCol = "Estimate"
  )

mass11SexChangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day:sexM"
    , valCol = "Estimate"
  )

mass11SexLBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day:sexM"
    , valCol = "Estimate"
  )
```

## Body mass of mass LBN pups seems most impacted by the paradigm

- Predicted body mass on P11:
  - STD female: `r round(mass11Intercept, 1)`g. 
  - LBN female: `r round(mass11Intercept+mass11LBN, 1)`g. 
  - STD male: `r round(mass11Intercept+mass11Sex, 1)`g
  - LBN male: `r round(mass11Intercept+mass11LBN+mass11Sex+mass11LBNchangeSex, 1)`g
- Predicted change in body mass from P11 to P21:
  - STD female: `r round(mass11PND*10, 1)`g
  - LBN female: `r round((mass11PND+mass11LBNchangePND)*10, 1)`g
  - STD male: `r round((mass11PND+mass11SexChangePND)*10, 1)`g
  - LBN male: `r round((mass11PND+mass11SexChangePND+mass11SexLBNchangePND+mass11LBNchangePND)*10, 1)`g
  
## After weaning, female LBN pups are a little bit slower to gain body mass

```{r}
mass_plot_1stL +
  coord_cartesian(x = c(22, 35), y = c(0, 25))
```

## After weaning, female LBN pups are a little bit slower to gain body mass

```{r}
lmm <- mass_long %>%
  filter(
    day >= 22 & day <= 35
  ) %>%
  mutate(
    day = day - 22
  ) %>%
  runLMM(
    mass ~ earlyLifeTrt * day * sex + (1|damID) + (1|mouseID)
  )

lmm$anova %>% formatLMM_ppt()
```


## After weaning, female LBN pups are a little bit slower to gain body mass

```{r}

lmm$coefs %>% formatLMM_ppt()

coefs <- lmm$coefs

mass22Intercept <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "(Intercept)"
    , valCol = "Estimate"
  )

mass22LBN <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN"
    , valCol = "Estimate"
  )

mass22Sex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "sexM"
    , valCol = "Estimate"
  )

mass22PND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day"
    , valCol = "Estimate"
  )

mass22LBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day"
    , valCol = "Estimate"
  )

mass22LBNchangeSex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:sexM"
    , valCol = "Estimate"
  )

mass22SexChangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day:sexM"
    , valCol = "Estimate"
  )

mass22SexLBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day:sexM"
    , valCol = "Estimate"
  )
```

## After weaning, female LBN pups are a little bit slower to gain body mass

- Predicted body mass on P22:
  - STD female: `r round(mass22Intercept, 1)`g
  - LBN female: `r round(mass22Intercept+mass22LBN, 1)`g
  - STD male: `r round(mass22Intercept+mass22LBN+mass22Sex+mass22LBNchangeSex, 1)`g
  - LBN male: `r round(mass22Intercept+mass22LBN+mass22Sex+mass22LBNchangeSex, 1)`g
- Change in body mass from P22 to P35:
  - STD female: `r round(mass22PND*13, 1)`g
  - LBN female: `r round((mass22PND+mass22LBNchangePND)*13, 1)`g. 
  - STD male: `r round((mass22PND+mass22SexChangePND)*13, 1)`g
  - LBN male: `r round((mass22PND+mass22SexChangePND+mass22SexLBNchangePND+mass22LBNchangePND)*13, 1)`g
  
  
## From P42 to P72, LBN males may gain slighly less than STD males, but may be of low biological significance


```{r}
mass_plot_1stL +
  coord_cartesian(x = c(42, 72))
```

## From P42 to P72, LBN males may gain slighly less than STD males, but may be of low biological significance

```{r}
lmm <- mass_long %>%
  filter(
    day >= 42
  ) %>%
  mutate(
    day = day - 42
  ) %>%
  runLMM(
    mass ~ earlyLifeTrt * day * sex + (1|damID) + (1|mouseID)
  )

lmm$anova %>% formatLMM_ppt()

```

## From P42 to P72, LBN males may gain slighly less than STD males, but may be of low biological significance

```{r}

coefs <- lmm$coefs

coefs %>% formatLMM_ppt()

mass42Intercept <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "(Intercept)"
    , valCol = "Estimate"
  )

mass42LBN <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN"
    , valCol = "Estimate"
  )

mass42Sex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "sexM"
    , valCol = "Estimate"
  )

mass42PND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day"
    , valCol = "Estimate"
  )

mass42LBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day"
    , valCol = "Estimate"
  )

mass42LBNchangeSex <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:sexM"
    , valCol = "Estimate"
  )

mass42SexChangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "day:sexM"
    , valCol = "Estimate"
  )

mass42SexLBNchangePND <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:day:sexM"
    , valCol = "Estimate"
  )
```

## From P42 to P72, LBN males may gain slighly less than STD males, but may be of low biological significance

- Predicted body mass on P42:
  - STD female: `r round(mass42Intercept, 1)`g
  - LBN female: `r round(mass42Intercept+mass42LBN, 1)`g
  - STD male: `r round(mass42Intercept+mass42LBN+mass42Sex+mass42LBNchangeSex, 1)`g
  - LBN male: `r round(mass42Intercept+mass42LBN+mass42Sex+mass42LBNchangeSex, 1)`g
- Change in body mass per week from P42 to P72:
  - STD female: `r round(mass42PND*7, 1)`g
  - LBN female: `r round((mass42PND+mass42LBNchangePND)*7, 1)`g. 
  - STD male: `r round((mass42PND+mass42SexChangePND)*7, 1)`g
  - LBN male: `r round((mass42PND+mass42SexChangePND+mass42SexLBNchangePND+mass42LBNchangePND)*7, 1)`g
  
  
## Vaginal opening was not altered by LBN

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2

VO_age_plot
VO_mass_plot
```

## Vaginal opening was not altered by LBN

```{r}
lmm_age <- maturationFiltered %>%
  filter(
    sex == "F"
  ) %>%
  runLMM(
    VO_age ~ earlyLifeTrt + (1|damID)
  )

lmm_mass <- maturationFiltered %>%
  filter(
    sex == "F"
  ) %>%
  runLMM(
    VO_mass ~ earlyLifeTrt + (1|damID)
  )

# combine into one table
lmm_age$anova %>%
  mutate(
    effect = "VO age - earlyLifeTrt"
  ) %>%
  bind_rows(
    lmm_mass$anova %>%
      mutate(
        effect = "VO mass - earlyLifeTrt"
      )
  ) %>%
  rename(
    p = `Pr(>F)`
  )
```

## First estrus was not altered by LBN

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2

Estrus_age_plot
Estrus_mass_plot
```

## First estrus was not altered by LBN

```{r}
lmm_age <- maturationFiltered %>%
  filter(
    sex == "F"
  ) %>%
  runLMM(
    Estrus_age ~ earlyLifeTrt + (1|damID)
  )

lmm_mass <- maturationFiltered %>%
  filter(
    sex == "F"
  ) %>%
  runLMM(
    Estrus_mass ~ earlyLifeTrt + (1|damID)
  )

# combine into one table
lmm_age$anova %>%
  mutate(
    effect = "Estrus age - earlyLifeTrt"
  ) %>%
  bind_rows(
    lmm_mass$anova %>%
      mutate(
        effect = "Estrus mass - earlyLifeTrt"
      )
  ) %>%
  rename(
    p = `Pr(>F)`
  )
```

## Preputial separation was not altered by LBN

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2

PreputialSep_age_plot
PreputialSep_mass_plot
```

## Preputial separation was not altered by LBN

```{r}
lmm_age <- maturationFiltered %>%
  filter(
    sex == "M"
  ) %>%
  runLMM(
    PreputialSep_age ~ earlyLifeTrt + (1|damID)
  )

lmm_mass <- maturationFiltered %>%
  filter(
    sex == "M"
  ) %>%
  runLMM(
    PreputialSep_mass ~ earlyLifeTrt + (1|damID)
  )

# combine into one table
lmm_age$anova %>%
  mutate(
    effect = "Preputial separation age - earlyLifeTrt"
  ) %>%
  bind_rows(
    lmm_mass$anova %>%
      mutate(
        effect = "Preputial separation mass - earlyLifeTrt"
      )
  ) %>%
  rename(
    p = `Pr(>F)`
  )
```

# Estrous cycles - creating functions to analyze cycles

## Characterizing estrous cycles

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2
repCycles_STD_1stL
repCycles_LBN_1stL
```

## Characterizing estrous cycles

:::: {.columns}

::: {.column width="50%"}

```{r fig.height=5, fig.width=5.67}
repCycles_STD_1stL +
  geom_point(aes(color = isStartCycle, alpha = isStartCycle))+
  scale_color_manual(values = c("FALSE" = "black", "TRUE" = "red", "STD" = "grey30", "LBN" = "cyan4"))+
  scale_alpha_manual(values = c("FALSE" = .1, "TRUE" = 1))
```

:::

::: {.column width="50%"}

::: {.incremental}

- Cycle start day: An estrous day that is preceded by either a proestrous or diestrous day
- Cycle length: # days between two cycle start days
- Track
  - Day of first cycle start
  - Day of last cycle start
  - Days that are "outside" of a cycle (before first cycle start or after last)

:::

:::

::::

## LBN does not alter estrous cycles

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2

cyclesFiltered %>%
  scatterPlotLBN(
    yVar = numCycles
    , yLab = "# of cycles from P70-P90"
    , dotSize = 3
    , textSize = 16
  )

cyclesFiltered %>%
  scatterPlotLBN(
    yVar = cycleLength
    , yLab = "cycle length (days)"
    , dotSize = 3
    , textSize = 16
  )

```

## LBN does not alter estrous cycles

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2


cyclesFiltered %>%
  scatterPlotLBN(
    yVar = firstCycleDay
    , yLab = "first cycle day"
    , dotSize = 3
    , textSize = 16
  )

cyclesFiltered %>%
  scatterPlotLBN(
    yVar = percDaysInCycles
    , yLab = "% days in a cycle"
    , dotSize = 3
    , textSize = 16
  )
```

```{r}
lmm_numCycles <- cyclesFiltered %>%
  runLMM(
    numCycles ~ earlyLifeTrt + (1|damID)
  )
lmm_cycleLength <- cyclesFiltered %>%
  runLMM(
    cycleLength ~ earlyLifeTrt + (1|damID)
  )
lmm_firstCycleDay <- cyclesFiltered %>%
  runLMM(
    firstCycleDay ~ earlyLifeTrt + (1|damID)
  )
lmm_percDaysInCycles <- cyclesFiltered %>%
  runLMM(
    percDaysInCycles ~ earlyLifeTrt + (1|damID)
  )

lmm_numCycles$anova %>%
  mutate(
    effect = "# cycles - earlyLifeTrt"
  ) %>%
  bind_rows(
    lmm_cycleLength$anova %>%
      mutate(
        effect = "cycle length - earlyLifeTrt"
      )
  ) %>%
  bind_rows(
    lmm_firstCycleDay$anova %>%
      mutate(
        effect = "first cycle day - earlyLifeTrt"
      )
  ) %>%
  bind_rows(
    lmm_percDaysInCycles$anova %>%
      mutate(
        effect = "% days in cycles - earlyLifeTrt"
      )
  ) %>%
  rename(
    p = `Pr(>F)`
  )
```

## LBN does not alter the percent of days in estrous cycle stages

```{r}
percDaysStage_1stL
```

# Response to ALPS

## LBN does not affect corticosterone response in males

```{r}
maleCortPlot_1stL
```

## LBN led to increased post-ALPS serum corticosterone in proestrous females

```{r}
proCortPlot_no723 <- cortFilteredPro %>%
  filter(
    mouseID != 723
  ) %>%
  plotCort_bothL()
proCortPlot_no723
```

## The effect of LBN on ALPS is influenced by sex

```{r}
#| tbl-colwidths: [45, 11, 11, 11, 11, 11]
lmm <- cortFiltered_M_DiPro %>%
  filter(
    mouseID != 723
  ) %>%
  runLMM(
    cort ~ sex * earlyLifeTrt * adultTrt * time + (1|mouseID)
  )

lmm$coefs %>% formatLMM_ppt()

coefs <- lmm$coefs

cortIntercept <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "(Intercept)"
    , valCol = "Estimate"
  )

cortTime <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "time"
    , valCol = "Estimate"
  )

cortTime5h <- cortTime * 5

cortALPSTime <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "adultTrtALPS:time"
    , valCol = "Estimate"
  )

femaleSTDALPS5h <- cortTime5h + cortALPSTime * 5

cortMaleALPSTime <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "sexM:adultTrtALPS:time"
    , valCol = "Estimate"
  )

# not a significant contributor to the model
maleSTDALPS5h <- femaleSTDALPS5h + cortMaleALPSTime * 5

cortLBNALPStime <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "earlyLifeTrtLBN:adultTrtALPS:time"
    , valCol = "Estimate"
  )

femaleLBNALPS5h <- femaleSTDALPS5h + cortLBNALPStime * 5

cortMaleLBNALPSTime <- coefs %>%
  getValWhereOtherValTrue(
    matchCol = "effect"
    , matchVal = "sexM:earlyLifeTrtLBN:adultTrtALPS:time"
    , valCol = "Estimate"
  )
maleLBNALPS5h <- femaleLBNALPS5h + cortMaleLBNALPSTime *5
```

## The effect of LBN on ALPS is influenced by sex

- The estimated serum corticosterone level at the beginning of the paradigm is `r cortIntercept`ng/mL, and is not altered by sex or early-life treatment
- For adult CON animals
  - cort is expected to increase about `r cortTime5h`ng/mL at the end of the paradigm
  - this is not altered by sex or early-life treatment
- For adult ALPS animals, the expected cort rise for each group is:
  - pro STD-ALPS: `r femaleSTDALPS5h`
  - pro LBN-ALPS: `r femaleLBNALPS5h`
  - male STD-ALPS: `r maleSTDALPS5h` - note that this is not different than pro STD-ALPS
  - male LBN-ALPS: `r maleLBNALPS5h`

# GABA PSCs

## LBN and ALPS do not affect the frequency or amplitude of GABA PSCs

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2
GABAfreqPlot
GABAampPlot
```

## LBN and ALPS do not affect passive properties or recording quality

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2


RinputPlot

RseriesPlot

```

## LBN and ALPS do not affect passive properties or recording quality

```{r fig.height=5, fig.width=5.67}
#| layout-ncol: 2


capacitancePlot


holdingCurrPlot
```
